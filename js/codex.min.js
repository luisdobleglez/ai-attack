const panta=document.getElementById("panta"),salida=document.getElementById("salida"),intro=document.getElementById("intro"),centro=document.getElementById("centro"),restantes=document.getElementById("aliens-restantes"),disparos=document.getElementById("disparos"),cargando=document.getElementById("cargando"),puntos=document.getElementById("puntos"),vidasMonitor=document.getElementById("vidas"),continuar=document.getElementById("continuar"),jugar=document.getElementById("jugar"),sonidoBanda=document.getElementById("sonido-banda");let pararFuncion=!1,seguir=!1;document.addEventListener("keydown",e=>{"Enter"!==e.key||seguir?"Enter"===e.key&&seguir&&(sonidoBanda.volume=.8,arrancarJuego(3),cambiarFase(),continuar.remove()):(intro.style.display="block",setTimeout(()=>{intro.style.opacity=1},500),salida.style.opacity=1,sonidoBanda.play(),sonidoBanda.volume=.1,jugar.remove(),seguir=!0)}),jugar.addEventListener("click",()=>{intro.style.display="block",setTimeout(()=>{intro.style.opacity=1},500),salida.style.opacity=1,sonidoBanda.play(),sonidoBanda.volume=.1,jugar.remove(),seguir=!0}),continuar.addEventListener("click",()=>{sonidoBanda.volume=.8,arrancarJuego(3),cambiarFase(),continuar.remove()});class Alien{constructor(e,t,i,n="miguelito"){this.x=t||0,this.y=i||0,this.color=e||this.generarColorRandom(),this.tipo=n,this.alienDiv=this.crearAlien(),this.colisionDetectada=!1}generarColorRandom(){let e=["#59c132","#184a90","#59c132","#184a90"];return e[Math.floor(Math.random()*e.length)]}cambiarTipo(e){if("miguelito"===e)var t=`<code class="core-alien"></code><svg  version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 123.6 612 604.4" enable-background="new 0 123.6 612 604.4" xml:space="preserve"><g class="cabeza vivo"><polygon   fill="${this.color}"  points="1.4,461.7 1.4,529.5 69.2,529.5 69.2,461.7 69.2,393.9 1.4,393.9 	"/>
	<path   fill="${this.color}"  d="M543.9,393.9V327v-67.8h-67.8v-1v-66.9v-67.8h-67.8v67.8h-67.8h-67.8h-67.8v-67.8H137v67.8v66.9H69.2v67.8v67.8H137v1h67.8
		h67.8v66.9h67.8v-66.9h67.8h67.8h67.8v66.9v67.8h67.8v-67.8v-67.8H543.9z M204.8,327v-67.8h67.8V327H204.8z M408.3,327h-67.8v-67.8
		h67.8v66.9"/>
            	
	</g>
            <g  class="manos vivo">	
     		<path  fill="${this.color}" d="M340.5,461.7h-67.8h-67.8v67.8v67.8v67.8h67.8h67.8h67.8v-67.8v-67.8v-67.8H340.5z M340.5,597.3h-67.8v-67.8h67.8V597.3z"/>
            </g></svg>`;else if("calamar"===e)var t=`<code class="core-alien"></code><svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 -113.6 612 905.6" enable-background="new 0 -113.6 612 905.6" xml:space="preserve"><g class="cabeza vivo"><path fill="${this.color}" path d="M18,432v144h72v72h72v72h72v72h144v-72h72v-72h72v-72h72V432H450 M378,504h72v72h-72V504z M162,504h72v72h-72V504z"/></g><g  class="manos vivo">	<polygon fill="${this.color}" points="571.2,140.9 418.5,-11.8 316.7,90 265.8,39.1 367.6,-62.7 316.7,-113.6 163.9,39.1 265.8,140.9 214.8,191.9 113,90 	62.1,140.9 214.8,293.7 316.7,191.9 367.6,242.8 265.8,344.6 316.7,395.5 469.4,242.8 367.6,140.9 418.5,90 520.3,191.9 " /></g></svg>`;else"bisho"===e?(this.alienDiv.classList.add("bisho"),t=`<code class="core-alien"></code><svg id="bisho" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 0 612 792" enable-background="new 0 0 612 792" xml:space="preserve"><g class="cabeza vivo"><path  fill="${this.color}" d="M375.4,224.9H229.2v49.7h-48.7v48.7h-48.8v97.5h48.7v48.8h48.7v51.2h48.8v48.8h48.7v-48.7h48.7v-51.2h48.7V421h48.9v-97.6	h-48.7v-48.7h-48.7L375.4,224.9L375.4,224.9L375.4,224.9z M424.2,323.4l-0.1,97.6l-99.1-0.4l0-96.7L424.2,323.4z M180.4,420.9	v-97.5H277v97.5H180.4z"/><rect fill="${this.color}" x="179.1" y="518.6" width="50" height="50"/>	<rect fill="${this.color}"  x="375.1" y="520.9" width="50" height="50"/></g><g class="manos">
            <rect fill="${this.color}"  x="277.9" y="633.1" width="48.7" height="48.7"/>
	<rect fill="${this.color}"  x="2.8" y="363.4" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="566.1" y="363.4" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="277.9" y="72.1" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="476.2" y="556" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 1264.9222 636.7477)" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="90.9" y="559.8" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 609.9088 915.6835)" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="489.3" y="161.5" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 1008.2748 -45.9161)" width="48.7" height="48.7"/>
	<rect fill="${this.color}" x="79.6" y="159.3" transform="matrix(-0.7071 0.7071 -0.7071 -0.7071 307.3195 240.0597)" width="48.7" height="48.7"/></g></svg>`):"malote"===e?t=`<code class="core-alien"></code><svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"	 viewBox="0 0 31 29" enable-background="new 0 0 31 29" xml:space="preserve"><g class="cabeza vivo"><path fill="${this.color}" d="M27,8V4h-2V0h-4v4H10V0H6v4H4v4H0v16h2v-4h5v4h2v-4h5v4h3v-4h5v4h2v-4h5v4h2V8H27z M14,11H7V8h7V11z M25,11h-7V8h7V11z"/><g class="manos"><rect  fill="${this.color}"  x="2" y="24" width="5" height="5"/>	<rect  fill="${this.color}"  x="9" y="24" width="5" height="5"/><rect  fill="${this.color}"  x="17" y="24" width="5" height="5"/>	<rect  fill="${this.color}"  x="24" y="24" width="5" height="5"/>
           </g></svg>`:this.tipo=e;this.alienDiv&&(this.alienDiv.innerHTML=t,this.alienDiv.classList.add(e));let i=this.alienDiv.querySelector(".manos");if(i){let n=i.getBBox(),a=n.x+n.width/2,s=n.y+n.height/2;i.style.transformOrigin=`${a}px ${s}px`;let r=0;setInterval(()=>{r-=10,i.style.transform=`rotate(${r}deg)`},100)}}crearAlien(){if(pararFuncion)return;let e=document.createElement("div");return e.classList.add("alien"),e.innerHTML=this.tipo,panta.appendChild(e),e}borrarAlien(){this.alienDiv&&(this.alienDiv.remove(),this.alienDiv=null)}moverAlien(e,t){if(pararFuncion)return;let i=1,n=1,a=100*parseFloat(/saturate\(([\d.]+)\)/.exec(window.getComputedStyle(this.alienDiv).filter||"saturate(1)")[1]),s=()=>{this.alienDiv&&(this.x+=e*i,this.y+=t*n,this.alienDiv.style.left=`${this.x}px`,this.alienDiv.style.top=`${this.y}px`,this.x>dimensiones.anchoPantalla-this.alienDiv.offsetWidth?i=-1:this.x<0&&(i=1),this.y>dimensiones.altoPantalla&&(this.y=0,n<=15&&n++,this.alienDiv.classList.add("enfadado"),a=Math.min(a+10,100),this.alienDiv.style.filter=`saturate(${a.toString()}%)`),this.comprobarColision(),requestAnimationFrame(s))};s()}comprobarColision(){if(!this.colisionDetectada&&impacto(navin.nave,this.alienDiv)){if(this.colisionDetectada=!0,navin.vidas--,navin.vidas<=0){document.getElementById("sonido-fin").play(),navin.nave.remove(),vidasMonitor.innerHTML="",centro.style.display="block",setTimeout(()=>{centro.style.opacity=1},500);let e=document.querySelectorAll(".alien");for(let t of e)t.remove();pararFuncion=!0}else this.reiniciarNave();setTimeout(()=>{this.colisionDetectada=!1},500)}}reiniciarNave(){navin.nave.remove(),arrancarJuego(navin.vidas),vidasMonitor&&vidasMonitor.firstElementChild&&vidasMonitor.firstElementChild.remove()}}class AlienGenerator{constructor(e){this.veces=e}iniciarGeneracion(e,t,i){!(this.veces<=0)&&setTimeout(()=>{let n=new Alien;n.cambiarTipo(e),n.moverAlien(t,i),aliens.push(n),this.veces--,this.iniciarGeneracion(e,t,i)},(5*Math.random()+1)*1e3)}obtenerVeces(){return this.veces}}class Aguila{constructor(e,t,i,n,a,s){this.color=e||"#fff",this.velocidad=t||3,this.nave=this.crearAguila(),this.x=i,this.y=n||40,this.municion=a||5,this.vidas=s||3,this.realizarDisparo(),this.moverAguila()}getVidas(){return this.vidas}crearAguila(){let e=document.createElement("div");return e.setAttribute("id","nave"),e.innerHTML=`<svg width="27" height="33" viewBox="0 0 27 33" fill="none" <svg width="27" height="33" viewBox="0 0 27 33" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M24 15V18H21V12H18V6H15V0H11.9776L12 6H9V12H6V18H3.02239V15H0V21V24V30H3.02239H6.04478V29H9.06716V33H18V29H21V30H24.1791H27V24V22.5V21V15H24Z" fill="${this.color}"/><path d="M12 16H15V19H18V25H15V22H12V25H9V19H12V16Z" fill="#f40"/><rect y="15" width="3" height="3" fill="#f40"/><rect x="24" y="15" width="3" height="3" fill="#f40"/></svg>`,setTimeout(()=>{panta.appendChild(e)},2500),e}realizarDisparo(){let e=!1;document.addEventListener("keydown",t=>{" "===t.key&&!e&&this.municion>0&&(this.disparar(),document.getElementById("sonido-laser").play(),this.municion--,document.getElementById("disparos").innerHTML=document.getElementById("disparos").innerHTML.slice(0,-1),0===this.municion&&(e=!0))}),document.addEventListener("keyup",t=>{if(this.municion<=0&&this.municion>-1&&" "===t.key&&e){let i=setInterval(()=>{this.municion<5?(document.getElementById("sonido-cargando").play(),this.municion+=1,disparos.innerHTML+="█"):(clearInterval(i),e=!1,document.getElementById("sonido-cargando").pause())},700)}})}moverAguila(){this.x=0;let e=1;document.addEventListener("keydown",t=>{"ArrowLeft"===t.key||"a"===t.key?e=-1:("ArrowRight"===t.key||"s"===t.key)&&(e=1)}),document.addEventListener("keydown",e=>{let t=e.key.toLowerCase();"z"===t?this.velocidad>0&&(this.velocidad-=.5):"q"===t&&(this.velocidad+=.5)});let t=()=>{null!==this.nave&&(this.x=this.x+2*e*this.velocidad,this.nave.style.left=this.x+"px",this.x>dimensiones.anchoPantalla-this.nave.offsetWidth?e=-1:this.x<0&&(e=1),setTimeout(t,20))};t();let i=this.y,n=()=>{let e=1,t=!0;document.getElementById("sonido-reactor").play();let n=document.createElement("div");n.innerHTML='<img src="img/fuego.svg">',n.setAttribute("id","fuego"),this.nave.appendChild(n);let a=()=>{if(t){if(this.y>=200)document.getElementById("fuego")&&document.getElementById("fuego").remove(),e=-1;else if(this.y<=i&&-1===e){t=!1;return}this.y+=5*e,this.nave.style.bottom=this.y+"px",requestAnimationFrame(a)}};a()};document.addEventListener("keydown",e=>{("ArrowUp"===e.key||"w"===e.key)&&n()})}disparar(){if(!(this.municion<=0)){let e=document.createElement("div");e.classList.add("disparo"),e.style.top=this.nave.offsetTop+"px",e.innerHTML='<svg width="1" height="10" viewBox="0 0 1 10" xmlns="http://www.w3.org/2000/svg"><rect width="2" height="40" fill="#f40"/></svg>',e.style.left=this.nave.offsetLeft+this.nave.offsetWidth/2+"px",panta.appendChild(e);let t=()=>{let i=e.offsetTop;i-=5,e.style.top=i+"px",setTimeout(t,5),e.offsetTop<0&&e.remove();let n=document.querySelectorAll(".alien .core-alien");for(let a of n){let s=window.getComputedStyle(a.parentElement).filter;if(impacto(e,a)){switch(document.getElementById("sonido-bomba").play(),s){case"saturate(0.5)":puntos.innerHTML=parseInt(puntos.innerHTML)+500;break;case"saturate(0.6)":puntos.innerHTML=parseInt(puntos.innerHTML)+400;break;case"saturate(0.7)":puntos.innerHTML=parseInt(puntos.innerHTML)+300;break;case"saturate(0.8)":puntos.innerHTML=parseInt(puntos.innerHTML)+200;break;case"saturate(0.9)":puntos.innerHTML=parseInt(puntos.innerHTML)+100;break;case"saturate(1)":puntos.innerHTML=parseInt(puntos.innerHTML)+50}destruidas--,restantes.innerHTML=`${destruidas}`;let r=a.parentElement.offsetLeft,o=a.parentElement.offsetTop;e.remove(),a.parentElement.remove();let l=document.createElement("div");l.classList.add("alien-destruido"),l.style.left=r+"px",l.style.top=o+"px",l.innerHTML='<svg width="30" height="30" viewBox="0 0 33 34"  xmlns="http://www.w3.org/2000/svg" class="roto"><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" />              <rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /><rect x="26" y="26" width="1" height="1" /></svg>',panta.appendChild(l),panta.style.backgroundColor="#fff",setTimeout(()=>{l.style.opacity=0,l.style.transform="scale(4)";let e=l.querySelectorAll("rect");for(let t of e){let i=50*Math.random()-25,n=50*Math.random()-25,a=["#fff","#0ff","#0f0","#ff0","#ff0","#fff"];t.style.fill=a[Math.floor(Math.random()*a.length)],t.style.transform=`translate(${i}px, ${n}px)`}panta.style.backgroundColor="#000",setTimeout(()=>{l.remove()},1e4)},50),destruidas<=0&&(cambiarFase(),document.getElementById("sonido-nivel").play());return}}};t()}}}class Estrella{constructor(){this.y=0,this.moverEstrella()}moverEstrella(){let e=()=>{this.y+=1,document.getElementById("panta").style.backgroundPosition=`0px ${this.y}px`,requestAnimationFrame(e)};e()}}function ajustarPantalla(){let e=window.innerWidth,t=window.innerHeight;e>t?(panta.style.width=t+"px",panta.style.height=t+"px"):e<t?(panta.style.width=e+"px",panta.style.height=e+"px"):(panta.style.width=e+"px",panta.style.height=t+"px");let i=panta.offsetWidth,n=panta.offsetHeight;return{anchoPantalla:i,altoPantalla:n}}new Estrella;const dimensiones=ajustarPantalla();function impacto(e,t){let i=e.getBoundingClientRect(),n=t.getBoundingClientRect();return!(i.top>n.bottom-5||i.bottom<n.top+5||i.left>n.right-5||i.right<n.left+5)}window.addEventListener("resize",ajustarPantalla);let aliens=[],generador,destruidas,fase=0;function cambiarFase(){1==++fase?(destruidas=(generador=new AlienGenerator(10)).obtenerVeces(),generador.iniciarGeneracion("miguelito",2,.5),restantes.innerHTML=10):2===fase?(destruidas=(generador=new AlienGenerator(15)).obtenerVeces(),generador.iniciarGeneracion("bisho",3,1),restantes.innerHTML=15):3===fase?((generador=new AlienGenerator(35)).iniciarGeneracion("malote",3,.7),destruidas=generador.obtenerVeces(),restantes.innerHTML=35):4===fase&&((generador=new AlienGenerator(40)).iniciarGeneracion("calamar",4,1),destruidas=generador.obtenerVeces(),restantes.innerHTML=40)}function arrancarJuego(e){intro&&intro.remove(),e>0?navin=new Aguila("#fff",3,0,40,5,e):(navin.firstElementChild.remove(),navin=null)}disparos.innerHTML=`█████`;